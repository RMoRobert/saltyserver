<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${recipe.name + ' - Salty'}">Recipe - Salty</title>
    <th:block th:replace="~{fragments/css-headers :: css-headers}"></th:block>
    <style th:inline="none">
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .ingredients-list, .directions-list {
            list-style: none;
            padding-left: 0;
        }
        
        .ingredients-list li, .directions-list li {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }
        
        .ingredient-heading, .direction-heading {
            font-weight: 600;
            background: #e3f2fd !important;
            border-left-color: #1976d2 !important;
            font-size: 1.1em;
        }
        
        .ingredient-main {
            border-left-width: 5px;
            border-left-color: #4caf50 !important;
        }
        
        .directions-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 50px;
        }
        
        .directions-list {
            counter-reset: step-counter;
        }
        
        .directions-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 12px;
            background: #0d6efd;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .recipe-header-layout {
            align-items: flex-start;
        }
        
        .recipe-image-wrap {
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .recipe-image-wrap {
                width: 33%;
                max-width: 33%;
            }
        }
        
        .recipe-image {
            max-height: 300px;
            width: 100%;
            object-fit: cover;
        }
        
        .badge-favorite {
            background-color: #ffd700;
            color: #333;
        }
        
        .badge-want-to-make {
            background-color: #e74c3c;
        }
    </style>
</head>
<body class="has-header">
    <div class="container">
        <header th:replace="~{fragments/header :: header}"></header>
        
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <a th:href="@{/recipes}" class="text-decoration-none mb-3 d-inline-block">
                    ← Back to Recipes
                </a>
                
                <h1 class="display-5 mb-4 pb-2 border-bottom border-primary border-3" th:text="${recipe.name}">Recipe Name</h1>
                
                <div class="recipe-header-layout d-flex flex-column flex-md-row gap-3 mb-4">
                    <div class="recipe-image-wrap" th:if="${recipe.imageFilename != null and !recipe.imageFilename.isEmpty()}">
                        <img class="recipe-image rounded shadow" 
                             th:src="@{/api/recipes/images/{filename}(filename=${recipe.imageFilename})}" 
                             th:alt="${recipe.name}">
                    </div>
                    <div class="recipe-meta bg-light p-3 rounded flex-grow-1">
                        <div class="d-flex flex-wrap gap-3">
                            <div th:if="${recipe.course != null}">
                                <small class="text-muted text-uppercase d-block">Course</small>
                                <strong th:text="${recipe.course.name}"></strong>
                            </div>
                            <div th:if="${recipe.difficulty != null and recipe.difficulty != T(com.inuvro.saltyserver.model.Difficulty).NOT_SET}">
                                <small class="text-muted text-uppercase d-block">Difficulty</small>
                                <strong th:text="${recipe.difficulty.displayName}"></strong>
                            </div>
                            <div th:if="${recipe.rating != null and recipe.rating != T(com.inuvro.saltyserver.model.Rating).NOT_SET}">
                                <small class="text-muted text-uppercase d-block">Rating</small>
                                <strong th:text="${recipe.rating.displayName}"></strong>
                            </div>
                            <div th:if="${recipe.servings != null}">
                                <small class="text-muted text-uppercase d-block">Servings</small>
                                <strong th:text="${recipe.servings}"></strong>
                            </div>
                            <div th:if="${recipe.yield != null and !recipe.yield.isEmpty()}">
                                <small class="text-muted text-uppercase d-block">Yield</small>
                                <strong th:text="${recipe.yield}"></strong>
                            </div>
                            <div th:if="${recipe.isFavorite}">
                                <span class="badge badge-favorite">⭐ Favorite</span>
                            </div>
                            <div th:if="${recipe.wantToMake}">
                                <span class="badge badge-want-to-make text-white">Want to Make</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${recipe.introduction != null and !recipe.introduction.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Introduction</h2>
                    <div class="bg-light p-3 rounded border-start border-primary border-4" th:text="${recipe.introduction}"></div>
                </div>
                
                <div class="mb-4" th:if="${recipe.preparationTimes != null and !recipe.preparationTimes.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Preparation Times</h2>
                    <div class="d-flex flex-wrap gap-3">
                        <div class="bg-success bg-opacity-10 p-3 rounded border-start border-success border-3" th:each="prepTime : ${recipe.preparationTimes}">
                            <small class="text-muted text-uppercase d-block">[[${prepTime.type}]]</small>
                            <strong class="text-success fs-5" th:text="${prepTime.timeString}"></strong>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${recipe.ingredients != null and !recipe.ingredients.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Ingredients</h2>
                    <ul class="ingredients-list">
                        <li th:each="ingredient : ${recipe.ingredients}" 
                            th:classappend="${(ingredient.isHeading ? 'ingredient-heading' : '') + ' ' + (ingredient.isMain ? 'ingredient-main' : '')}">
                            <span th:text="${ingredient.text}"></span>
                        </li>
                    </ul>
                </div>
                
                <div class="mb-4" th:if="${recipe.directions != null and !recipe.directions.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Directions</h2>
                    <ol class="directions-list">
                        <li th:each="direction : ${recipe.directions}" 
                            th:classappend="${direction.isHeading} ? 'direction-heading' : ''"
                            th:text="${direction.text}"></li>
                    </ol>
                </div>
                
                <div class="mb-4" th:if="${recipe.notes != null and !recipe.notes.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Notes</h2>
                    <div>
                        <div class="alert alert-info mb-3" th:each="note : ${recipe.notes}">
                            <div class="fw-bold text-primary mb-2" th:if="${note.title != null and !note.title.isEmpty()}" th:text="${note.title}"></div>
                            <div th:text="${note.content}"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${recipe.variations != null and !recipe.variations.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Variations</h2>
                    <div>
                        <div class="alert alert-warning mb-3" th:each="variation : ${recipe.variations}">
                            <div class="fw-bold text-warning-emphasis mb-2" th:if="${variation.variationName != null and !variation.variationName.isEmpty()}" th:text="${variation.variationName}"></div>
                            <div th:text="${variation.text}"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${recipe.nutrition != null}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Nutrition Information</h2>
                    <div class="row g-3">
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.calories != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Calories</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.calories}"></strong>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.protein != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Protein</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.protein + 'g'}"></strong>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.carbohydrates != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Carbs</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.carbohydrates + 'g'}"></strong>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.fat != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Fat</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.fat + 'g'}"></strong>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.fiber != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Fiber</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.fiber + 'g'}"></strong>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6" th:if="${recipe.nutrition.sugar != null}">
                            <div class="bg-info bg-opacity-10 p-3 rounded text-center">
                                <small class="text-muted d-block">Sugar</small>
                                <strong class="text-info fs-4" th:text="${recipe.nutrition.sugar + 'g'}"></strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${(recipe.categories != null and !recipe.categories.isEmpty()) or (recipe.tags != null and !recipe.tags.isEmpty())}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Categories & Tags</h2>
                    <div class="d-flex flex-wrap gap-2">
                        <span class="badge bg-primary" th:each="category : ${recipe.categories}" th:text="${category.name}"></span>
                        <span class="badge bg-secondary" th:each="tag : ${recipe.tags}" th:text="${tag.name}"></span>
                    </div>
                </div>
                
                <div class="mb-4" th:if="${recipe.source != null and !recipe.source.isEmpty()}">
                    <h2 class="h4 mb-3 pb-2 border-bottom">Source</h2>
                    <p th:text="${recipe.source}"></p>
                    <p th:if="${recipe.sourceDetails != null and !recipe.sourceDetails.isEmpty()}" th:text="${recipe.sourceDetails}"></p>
                </div>
            </div>
        </div>
    </div>
    <th:block th:replace="~{fragments/css-headers :: bootstrap-js}"></th:block>
</body>
</html>
